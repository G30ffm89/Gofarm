FROM golang:1.24-bookworm AS builder

WORKDIR /app

COPY go.mod .
COPY go.sum .

COPY . .

RUN go mod download -x

WORKDIR /app/website/cmd/web

RUN go build -o main .

FROM debian:stable-slim

WORKDIR /app

COPY --from=builder /app/website/cmd/web/main .

COPY --from=builder /app/website/ui ./ui
COPY --from=builder /app/website/cmd/web/config.json .

VOLUME /instance

EXPOSE 4000

RUN chmod +x main

# Command to run the executable
CMD ["./main", "-dsn", "instance/snippets.db"]